---
title: "Distribuição dos psicólogos nos níveis assistenciais na 11º região de saúde do Ceará"
format: html
editor_options: 
  chunk_output_type: console
---
```{r}
#| echo: false
#| warning: false
library(tidyverse)
library(rstatix)
library(flextable)
library(MKinfer)
library(gtsummary)
library(ggpubr)
library(janitor)
```

```{r}
#| echo: false
#| warning: false

df <- read_csv("data/dados-limpo.csv")

df_limpo <- df |> 
    filter(nivel_atencao %in% c("atenção primária", "atenção secundária", "atenção terciária"),
    codigo_municipio %in% c(230050, 230310, 230365, 230400, 230435, 230450, 230465, 230490, 230520, 230580, 230610, 230800, 230820, 230880, 230900, 230990, 231095, 231170, 231200, 231220, 231280, 231290, 231390, 231395)) |>
    select(nome, nome_do_municipio, codigo_municipio, populacao_muni, estabelecimento , nivel_atencao, codigo_estabelecimento_saude, codigo_profissional_saude, populacao_muni, cbo)

df_analise <- df_limpo |>
    select(nome, nome_do_municipio, nivel_atencao, populacao_muni) |>  
    group_by(nome_do_municipio, nivel_atencao, populacao_muni) |> 
    summarise(total_vinculos = n(), .groups = "drop") |> 
    mutate(pop_vinculo = populacao_muni / total_vinculos,
    nivel_atencao = as_factor(nivel_atencao)) 

# quantidade de psicólogos por nível de atenção
df_limpo |> 
  count(nivel_atencao)

# quantidade de municípios
df_limpo |> 
  count(nome_do_municipio)

# códigos de profissionais repetidos
codigos_repetidos <- df_limpo |> 
  group_by(codigo_profissional_saude) |> 
  summarise(qde_vinculos = n()) |> 
  filter(qde_vinculos > 1) |> 
  arrange(desc(qde_vinculos)) |> 
  pull(codigo_profissional_saude) 

# detalhes dos profissionais repetidos
profissionais_repetidos <- df_limpo |> 
  filter(codigo_profissional_saude %in% c(codigos_repetidos)) |>  
  select(nome, nome_do_municipio, nivel_atencao, codigo_profissional_saude) |> 
  arrange(codigo_profissional_saude)

profissionais_repetidos |> 
  group_by(nivel_atencao) |> 
  summarise(n = n())

# banco para teste t
df_t <- df_analise |> 
    filter(nivel_atencao %in% c("atenção primária", "atenção secundária"))

# banco para correlação
## correlação população e quantidade de vínculos de psicólogos
df_cor <- df_analise |> 
  select(nome_do_municipio, populacao_muni, total_vinculos) |> 
  group_by(nome_do_municipio, populacao_muni) |> 
  summarise(total_vinculos = sum(total_vinculos, na.rm = T), .groups = "drop")


## correlação população e quantidade de vínculos de psicólogos na atenção primária
df_cor_p <- df_analise |> 
    filter(nivel_atencao == "atenção primária") |> 
    select(populacao_muni, total_vinculos) 
    
## correlação população e quantidade de vínculos de psicólogos na atenção secundária
df_cor_s <- df_analise |>
    filter(nivel_atencao == "atenção secundária") |> 
    select(populacao_muni, total_vinculos) 

# adicionar variável igual em todos os bancos
df_geral <- df_cor |> 
  mutate(categoria = "Rede geral")

df_primaria <- df_cor_p |> 
  mutate(categoria = "Atenção primária")

df_secundaria <- df_cor_s |> 
  mutate(categoria = "Atenção secundária")

# juntar banco de dados
df_plot <- bind_rows(df_geral, df_primaria, df_secundaria)

df_plot <- df_plot |> 
  mutate(categoria = factor(categoria, levels = c("Rede geral", "Atenção primária", "Atenção secundária")))
    
```

# Método
## Coleta e processamento de dados
A coleta foi referente ao mês de julho de 2025. Os dados foram extraídos da plataforma do Cadastro Nacional de Estabelecimentos de Saúde (CNES) (Ministério da Saúde, 2025). As informações sobre a população residente nos municípios foram retiradas das estimativas realizadas pelo Instituto Brasileiro de Geografia e Estatística (IBGE) (Instituto Brasileiro de Geografia e Estatística [IBGE], 2025). 

O processamento dos dados foi realizado com a linguagem R (versão 4.4.3) através do RStudio (versão 2025.05.1). Para a preparação do banco de dados final, realizou-se incialmente a junção das tabelas com informação sobre vínculos, profissionais e estabelecimentos de saúde. Por fim, agregou-se a elas o banco de dados do IBGE com a população do munícipio por meio do seu respectivo código definido pelo referido instituto. Aplicaram-se filtros para selecionar apenas profissionais de psicologia com base na Classificação Brasileira de Ocupações (CBO) e que atendiam no SUS.

Os estabelecimentos de saúde foram categorizados em atenção primária, secundária e terciária, sistemas de apoio e sistemas logísticos de acordo com as diretrizes do ministério da saúde (2017). A classificação quanto à atuação de dado psicólogo seguiu a categorização relativa ao estabelecimento. Assim, se ele trabalhar em um dispositivo pertencente à atenção primária, entende-se que o respectivo profissional atua na APS. Ressalta-se que alguns profissionais poderiam estar repetidos no banco de dados, tendo em vista a possibilidade de ele operar em mais de um nível, razão pela qual se procurou medir também o quantitativo desses casos. 

Adicionalmente, utilizou-se o pacote genderBR para a inferência de gênero dos profissionais a partir dos nomes registrados. Para a manipulação e tratamento dos dados, empregaram-se os pacotes tidyverse, arrow e janitor. O código completo e a estrutura de dados detalhada estão disponíveis no repositório do projeto [Link do GitHub].

Para delimitação do escopo de análise, foi aplicado um recorte territorial focado nos 24 municípios que compõem a 11º região de saúde do Ceará. Também foram filtrados apenas os estabelecimentos classificados nos níveis de atenção primária, secundária e terciária, excluindo os sistemas logísticos e de apoios por não prestarem atendimento assistencial direto em psicologia.

A fim de analisar a distribuição de psicólogos na referida região, foi adicionada uma coluna que divide a população de cada município pelo número de profissionais cadastrados. Essa variável foi nomeada como “pop_vinculo”, com a intenção de ser um índice de cobertura assistencial indireto. Esse indicador, apesar de não corresponder diretamente à carga de trabalho real do profissional, permite estimar a razão entre a população potencialmente assistida e profissionais disponíveis. 

Assim, o banco de dados final permitiu visualizar o total de vínculos por nível de atenção para cada município, bem como a sua cobertura assistencial nos três níveis. 

## Amostra
### Características demográficas e distribuição dos equipamentos
```{r}
#| echo: false
#| warning: false

# população da 11º região
df_muni_pop <- df_limpo |> 
  group_by(nome_do_municipio) |> 
  summarise(populacao = first(populacao_muni))

muni_pop <- sum(df_muni_pop$populacao)

# população do Ceará
df_ce_pop <- df |> 
  filter(estado == "CE") |> 
  group_by(nome_do_municipio) |> 
  select(nome_do_municipio, populacao_muni) |> 
  summarise(populacao = first(populacao_muni))

ce_pop <- sum(df_ce_pop$populacao)

# razão entre população dos municípios da microsobral e ceará
rz_muni_ce <- round((muni_pop / ce_pop) * 100, digits = 2)

# população da marcorregião norte
df_macro_norte_pop <- df_ce_pop |> 
  filter(nome_do_municipio %in% c(
  # SOBRAL
  "Sobral", "Alcântaras", "Cariré", "Catunda", "Coreaú", "Forquilha", 
  "Frecheirinha", "Graça", "Groaíras", "Hidrolândia", "Irauçuba", 
  "Massapê", "Meruoca", "Moraújo", "Mucambo", "Pacujá", "Pires Ferreira", 
  "Reriutaba", "Santa Quitéria", "Santana do Acaraú", "Senador Sá", "Varjota", "Ipu","Uruoca",

  # ACARAÚ
  "Acaraú", "Bela Cruz", "Cruz", "Itarema", "Marco", "Morrinhos", "Jijoca de Jericoacoara",

  # TIANGUÁ
  "Tianguá", "Carnaubal", "Croatá", "Guaraciaba do Norte", "Ibiapina", 
  "São Benedito", "Ubajara", "Viçosa do Ceará",

  # CRATEÚS
  "Ararendá", "Crateús", "Independência", "Ipaporanga", "Ipueiras", 
  "Monsenhor Tabosa", "Nova Russas", "Novo Oriente", "Poranga", 
  "Quiterianópolis", "Tamboril",

  # CAMOCIM
  "Camocim", "Barroquinha", "Chaval", "Granja", "Martinópole"))

macro_norte_pop <- sum(df_macro_norte_pop$populacao)

# razão entre população dos municípios da microsobral e macrorregião norte
rz_muni_macro <- round((muni_pop / macro_norte_pop) * 100, digits = 2)
```

```{r}
#| echo: false
#| warning: false

estab <- df_limpo |> 
  select(estabelecimento, nivel_atencao) |> 
  group_by(estabelecimento, nivel_atencao) |> 
  summarise(total = n(), .groups = "drop") |> 
  arrange(nivel_atencao, desc(total))

total_estab <- sum(estab$total)

total_estab_prim <- estab |> 
  filter(estabelecimento %in% c("CENTRO DE SAUDE/UNIDADE BASICA", "POSTO DE SAUDE", "CENTRO DE APOIO A SAUDE DA FAMILIA")) |> 
  pull(total) |> 
  sum()
```

A 11º região de saúde do Ceará totaliza `r format(muni_pop, big.mark = ".", decimal.mark = ",")` mil habitantes o que representa `r format(rz_muni_macro, big.mark = ".", decimal.mark = ",")`% da população da Superintendência Regional de Saúde Norte (`r format(macro_norte_pop, big.mark = ".", decimal.mark = ",")` milhões) e `r format(rz_muni_ce, big.mark = ".", decimal.mark = ",")`% da população do Ceará (`r format(ce_pop, big.mark = ".", decimal.mark = ",")` milhões) e (IBGE, 2025). Foram identificados `r total_estab` estabelecimentos, sendo a maior parte pertencente à atenção primária (`r total_estab_prim`) e localizados no município de Sobral (ver tabela 1).

```{r}
#| echo: false
#| warning: false

tabela_estab <- df_limpo |> 
  select(nome_do_municipio, estabelecimento, nivel_atencao) |>
  group_by(nome_do_municipio, estabelecimento, nivel_atencao) |> 
  summarise(total_estabelecimento = n(), .groups = "drop") |>
  mutate(estabelecimento = str_to_sentence(estabelecimento),
         nivel_atencao = str_to_sentence(nivel_atencao)) |> 
  flextable() |> 
  flextable::font(fontname = "Times New Roman", part = "all") |> 
  fontsize(size = 12, part = "all") |> 
  set_header_labels(nome_do_municipio = "Município",
                    estabelecimento = "Tipo de estabelecimento",
                    nivel_atencao = "Nível assistencial",
                    total_estabelecimento = "Total") |> 
  autofit() |> 
  set_caption("Distribuição dos estabelecimentos de saúde na 11º região de saúde")
  
tabela_estab
```

### Psicólogos e níveis assistenciais

Quanto ao total de psicólogos, foram contabilizados 171 vínculos cadastrados nos estabelecimentos. Destes, 96 atuam na atenção primária, 63 na secundária e 12 na terciária. Logo, foram encontrados psicólogos atuando em todos os níveis de atenção. Os únicos municípios com psicólogos na atenção terciária foram Sobral (11) e Reriutaba (1). Dentre os 24 municípios, 12 tem o seu maior quantitativo de vínculos na atenção primária; 7 apresentam predominância na atenção secundária;e 5 não possuem diferença entre os dois níveis. Não houve maior contingente no nível terciário em nenhum dos municípios. Para mais detalhes, consultar tabela 2.

```{r}
#| echo: false
#| warning: false
df_tabela <- df_analise |>  
    select(nome_do_municipio, nivel_atencao, total_vinculos) |> 
    arrange(desc(total_vinculos)) |> 
    pivot_wider(names_from = nivel_atencao, 
    values_from = total_vinculos,
    values_fill = 0) |> 
    clean_names() |> 
    mutate(vinculos_municipio = rowSums(across(starts_with("atencao_")), na.rm = T),
    porcentagem = vinculos_municipio / sum(vinculos_municipio))|> 
    as_data_frame() |> 
    relocate(atencao_primaria, .after = nome_do_municipio)

tabela_psi <- df_tabela |> 
    adorn_totals("row", name = "Total") |> 
    flextable() |> 
    autofit() |> 
    colformat_double(j = "porcentagem", 
    digits = 0, suffix = "%") |>
    set_formatter(porcentagem = function(x) sprintf("%.0f%%", x * 100)) |> 
  set_header_labels(nome_do_municipio = "Município",
                    atencao_primaria = "Atenção primária",
                    atencao_secundaria = "Atenção secundária",
                    atencao_terciaria = "Atenção terciária",
                    vinculos_municipio = "Vínculos",
                    porcentagem = "Porcentagem") |> 
  flextable::font(fontname = "Times New Romen", part = "all") |> 
  fontsize(size = 12, part = "all") |> 
    set_caption("Distribuição dos vínculos de psicólogos na 11º região de saúde ")

tabela_psi
```

## Procedimento de análise de dados
As análises também foram realizadas utilizando o software R (R Core Team, 2025). Foi usado o pacote tidyverse para importação, manipulação e visualização de dados; o rstatix para verificar os pressupostos de normalidade (teste de Shapiro-Wilk) e homogeneidade de variância (teste de Levene), o tamanho de efeito e a correlação bivariada; o MKinfer para cumputar o teste t de Student com bootstrapping; ggpubr e o scales para aprimorar os gráficos das correlações. 

O teste t de Student para amostras independentes objetivou investigar em que medida a cobertura de psicólogos era diferente entre os níveis primário e secundário. Foram realizados procedimentos de bootstrapping (1000 re-amostragens; 95% IC) para se obter uma maior confiabilidade dos resultados, para corrigir desvios de normalidade da distribuição da amostra, diferenças entre os tamanhos dos grupos e para apresentar um intervalo de confiança de 95% para as diferenças entre as médias (Haukoos & Lewis, 2005).

Os teste de correlação avaliou em que medida o contingente populacional de dado município estava associado com o total de vínculos de psicólogos. Tal análise foi feita para os níveis primário e secundário agrupados e para a atenção primária e secundária separadamente, a fim de verificar se a associação existia e se tal padrão se mantém nesses níveis isoladamente. Optou-se por excluir a atenção terciária, na medida em que havia vínculos de psicólogos em apenas dois municípios (Sobral e Reriutaba). Para contornar a discordância com o pressuposto de normalidade, baixo tamanho amostral e a presença de um outileir (Sobral), decidiu-se utilizar o tau de Kendall por apresentar menor viés que o rho de Spearman e o coeficiente de Pearson nessas circuntâncias (Xu et al., 2013). 

## Considerações éticas
Uma vez que os dados utilizados são de acesso público, a submissão ao comitê de ética não se fez necessária, o que está em conformidade com a Resolução nº 510, de 7 de abril de 2016 do Conselho Nacional de Saúde.

# Resultados

Os resultados indicaram desvio de normalidade para a cobertura de psicólogos (vínculos por habitantes) apenas na atenção secundária (*W* =  0,78; *p*< 0,001). Além disso, observou-se a existência de psicólogos atuando na atenção primária em todos os 24 municípios, mas apenas 18 cidades contavam com a presença de tais profissionais no nível secundário (ver tabela 1). Embora exista essa diferença, a relação entre habitantes por vínculo de psicólogos  não apresentou diferença significativa (*t*(25,37) = -1,44, *p* = 0,09) [IC 95% -8966,91, 636,87], com tamanho de efeito pequeno (d de Cohen = 0,48).

```{r}
#| echo: false
#| warning: false
tabela_descritiva <- df_t |> 
  group_by(nivel_atencao) |> 
  summarise(n = n(), media = mean(pop_vinculo, na.rm = T), desvio_padrao = sd(pop_vinculo, na.rm = T)) |> 
  flextable() |> 
  set_header_labels(nivel_atencao = "Nível assistencial", n = "Nº de municípios", media = "Média", desvio_padrao = "Desvio-Padrão") |> 
  colformat_double(digits = 2, big.mark = ".", decimal.mark = ",") |> 
  autofit() |> 
  set_caption("Habitantes por Psicólogo por Nível de Atenção")
tabela_descritiva
```

Também houve ausência de normalidade para as variáveis população municipal e total de vínculos de psicólogos tanto quando se agrupou atenção primária e secundária, quanto na situação em que foram analiadas isoladamente. Além disso, o teste de correlação tau de Kendall mostrou que existe associação significativa, positiva e moderada entre o tamanho populacional e o número de vínculos de psicólogos ($\tau$ = 0,44; p < 0,01) quando se observa a rede de modo agregado. Entretanto, esse relação não se sustenta quando os níveis de assistenciais são analisados do modo separado. A atenção primária apresentou uma correlação fraca e não significativa ($\tau$ = 0,21; p < 0,21), assim como a secundária ($\tau$ = 0,25; p < 0,18) (ver figura 1).

```{r}
#| echo: false
#| warning: false
cor_plot <- df_plot |>
  ggplot(aes(x = populacao_muni, y = total_vinculos)) +
  geom_point(color = "black", alpha = 0.7, size = 2) +
  geom_smooth(method = "lm", color = "black", se = F) +
  facet_wrap(~categoria, scales = "fixed") +
  scale_y_log10(breaks = c(1, 2, 5, 10, 20, 50)) +
  scale_x_log10(breaks = c(5000, 10000, 25000, 50000, 100000, 250000))+
  labs(
    title = "Relação entre População e Vínculos de Psicólogos",
    subtitle = "Região de Saúde 11 - Ceará",
    x = "População do município",
    y = "Número de vínculos" 
  ) +
  theme_bw() +
  theme(
    strip.text = element_text(face = "bold", size = 11),
    panel.grid.minor = element_blank(),
    strip.background = element_rect(fill = "gray95"))
  
cor_plot
```
# Referências

Conselho Nacional de Saúde. (2016). Resolução nº 510, de 7 de abril de 2016. Dispõe sobre as normas aplicáveis a pesquisas em Ciências Humanas e Sociais. http://conselho.saude.gov.br/resolucoes/2016/Reso510.pdf

Instituto Brasileiro de Geografia e Estatística. (2025). Estimativas de população. https://www.ibge.gov.br/estatisticas/sociais/populacao/9103-estimativas-de-populacao.html

Ministério da Saúde. (2025). Cadastro Nacional de Estabelecimentos de Saúde (CNES): Bases de dados. Recuperado em [insira o dia e mês da coleta], 2025, de https://cnes.datasus.gov.br/pages/downloads/arquivosBaseDados.jsp

Ministério da Saúde. (2017, 28 de setembro). Portaria de consolidação nº 3, de 28 de setembro de 2017. Consolidação das normas sobre as redes do Sistema Único de Saúde. Biblioteca Virtual em Saúde do Ministério da Saúde. https://bvsms.saude.gov.br/bvs/saudelegis/gm/2017/prt0003_28_09_2017.html

Xu, W., Hou, Y., Hung, Y. S., & Zou, Y. (2013). A comparative analysis of Spearman’s rho and Kendall’s tau in normal and contaminated normal models. Signal Processing, 93(1), 261–276. https://doi.org/10.1016/j.sigpro.2012.08.005
