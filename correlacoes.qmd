---
title: "Untitled"
format: html
---

```{r}
library(rstatix)
library(tidyverse)
library(janitor)
library(flextable)
library(ggpubr)
library(scales)
```

# Correlação entre população e quantidade de vínculos 

## testanto pressuposto
```{r}
df_cor |> 
  shapiro_test(populacao_muni)

df_cor |> 
  shapiro_test(total_vinculos)
```

A normalidade dos dados não foi acatada pelo teste de Shapiro-Wilk para a variável população (w=0,419; p < 0,001) nem para o total de vínculos no município (w=0,417; p < 0,001). 

## correlação de spearman
```{r}
correlacao <- df_cor |> 
  cor_test(vars = populacao_muni, vars2 = total_vinculos, alternative = "two.sided", method = "spearman")
```

Procedeu, assim, à realização do teste de correlação de Spearman, o qual indicou que há uma associação significativa e moderada (Rs (22) = 0,57; p < 0,01), o que sugere que a quantidade vínculos é maior onde há uma população mais numerosa. Entretanto, quando se analisou  apenas a quantidade de vínculos na atenção primária (Rs (22) = 0,28; p < 0,18) e secundária (Rs (16) = 0,33; p < 0,18) separadamente, observou-se que não existia associação significativa. 

# Correlação entre população e quantidade de vínculos na primária
## Testando pressupostos
```{r}
df_cor_p |> 
  shapiro_test(populacao_muni, total_vinculos) 
```

## correlação de spearman
```{r}
df_cor_p |> 
  cor_test(vars = populacao_muni, vars2 = total_vinculos, alternative = "two.sided", method = "spearman")
```

# Correlação entre população e quantidade de vínculos na secundária
## testando pressupostos

```{r}
df_cor_s |> 
  shapiro_test(populacao_muni, total_vinculos)
```

## correlação de spearman
```{r}
df_cor_s |> 
  cor_test(vars = populacao_muni, vars2 = total_vinculos, alternative = "two.sided", method = "spearman")
```

# Resultados
Os reusltados do teste de Shapiro-Wilk indicaram ausência de normalidade para as variáveis população municipal e total de vínculos de psicólogos em todas as situações analisadas. Além disso, o teste de correlação de Spearman mostrou que existe associação significativa, positiva e moderada entre o tamanho populacional e o número de vínculos de psicólogos (Rs = (22) = 0,57; p < 0,01) quando se observa a rede de modo agregado. Entretanto, esse relação não se sustenta quando os níveis de atenção são analisados do modo separado. A atenção primária apresentou uma correlação fraca e não significativa (Rs (22) = 0,28; p < 0,18), assim como a secundária (Rs (16) = 0,33; p < 0,18) (ver figura x). 

# Visualização

```{r}
# adicionar variável igual em todos os bancos
df_geral <- df_cor |> 
  mutate(categoria = "Rede geral")

df_primaria <- df_cor_p |> 
  mutate(categoria = "Atenção primária")

df_secundaria <- df_cor_s |> 
  mutate(categoria = "Atenção secundária")

# juntar banco de dados
df_plot <- bind_rows(df_geral, df_primaria, df_secundaria)

df_plot <- df_plot |> 
  mutate(categoria = factor(categoria, levels = c("Rede geral", "Atenção primária", "Atenção secundária")))
```

```{r}
cor_plot <- df_plot |>
  ggplot(aes(x = populacao_muni, y = total_vinculos)) +
  geom_point(color = "black", alpha = 0.7, size = 2) +
  geom_smooth(method = "lm", color = "black", se = F) +
  facet_wrap(~categoria, scales = "fixed") +
  scale_y_log10(breaks = c(1, 2, 5, 10, 20, 50)) +
  scale_x_log10(breaks = c(5000, 10000, 25000, 50000, 100000, 250000))+
  labs(
    title = "Relação entre População e Vínculos de Psicólogos",
    subtitle = "Região de Saúde 11 - Ceará",
    x = "População do município",
    y = "Número de vínculos"
  ) +
  theme_bw() +
  theme(
    strip.text = element_text(face = "bold", size = 11),
    panel.grid.minor = element_blank(),
    strip.background = element_rect(fill = "gray95"))
  
cor_plot
```